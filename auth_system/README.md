### Custom Auth System — Тестовое задание

## Описание
Это backend-приложение реализует собственную систему аутентификации и авторизации без полной зависимости от встроенных механизмов Django и DRF.

Цель — продумать архитектуру доступа к ресурсам, реализовать регистрацию, логин, выход, мягкое удаление и обновление профиля, а также ролевую модель с разграничением доступа


## Функциональность
### Аутентификация
* Регистрация
Пользователь указывает имя, email, пароль и подтверждение пароля.

* Логин
Аутентификация по email и паролю. При успехе выдается токен.

* Logout
Пользователь выходит, токен становится недействительным.

* Мягкое удаление аккаунта
Флаг is_active переводится в False, вход становится невозможен.

* Обновление профиля
Имя, email и другие поля можно изменить через соответствующий эндпоинт.

## Структура базы данных

### Пользователь (`User`)
- `id`: UUID
- `email`: Email (уникальный)
- `first_name`, `patronymic`: Текст
- `password`: Хешированный пароль
- `role`: [user, admin] — тип пользователя
- `is_active`: логическое поле (используется для мягкого удаления)

### Токен (`AuthToken`)
- `id`: UUID
- `user`: FK → User
- `key`: Токен (уникальный, str)
- `created_at`: Дата создания
- `expires_at`: Дата истечения (7 дней)

## Роли и права доступа

| Роль          | Описание      |
| ------------- | ------------- |
| user          | Обычный пользователь  |
| admin         | Администратор системы  |

| Роль  | Доступ к mock-ресурсам | Редактирование доступа |
|-------|-------------------------|-------------------------|
| user  | Только `GET`            | Нет                    |
| admin | Полный доступ           | Да                     |

Валидация прав:
- Если пользователь не аутентифицирован → `401 Unauthorized`
- Если пользователь аутентифицирован, но не имеет доступа → `403 Forbidden`

### Готовые пользователи в БД
```JSON
Admin
Token e927ed96-a88f-4ca8-b885-f1f602f13001
{
	"email": "admin@gmail.com",
	"first_name": "admin",
	"patronymic": "admin",
	"password": "123",
	"password_repeat": "123"
}

User
Token 789aa14a-b97a-4e7f-b93f-0a6ca83d175c
{
	"email": "user@gmail.com",
	"first_name": "user",
	"patronymic": "user",
	"password": "123",
	"password_repeat": "123"
}
```


### Правила доступа:

| Ресурс / Действие                    | Анонимный пользователь | Авторизованный пользователь | Администратор |
|-------------------------------------|-------------------------|------------------------------|----------------|
| Просмотр ресурса                    | ✅                      | ✅                          | ✅             |
| Создание ресурса                    | ❌                      | ✅                          | ✅             |
| Обновление / ресурса                | ❌                      | ✅                          | ✅             |
| Управление пользователями           | ❌                      | ❌                          | ✅             |
| Изменение ролей                     | ❌                      | ❌                          | ✅             |


### Примеры эндпоинтов

| Маршрут                  | Метод  | Описание                                          | Доступ                 |
| ------------------------ | ------ | ------------------------------------------------- | ---------------------- |
| `/api/register/`         | POST   | Регистрация нового пользователя                   | Аноним                 |
| `/api/profile/`          | PATCH  | Обновление своих данных (пользователя)            | Только авторизованные  |
| `/api/login/`            | POST   | Авторизация пользователя                          | Аноним                 |
| `/api/logout/`           | DELETE | Деаутентификация (logout) или выход               | Только авторизованные  |
| `/api/admin/users/`      | GET    | Получение списка всех пользователей               | Только админ           |
| `/api/admin/users/<id>/` | PUT    | Обновление данных пользователя(В том числе изменение ролей) | Только админ |
| `/api/admin/users/<id>/` | DELETE | Деактивация пользователя                          | Только админ           |
| `/api/public/`           | GET    | Публичный ресурс, доступен всем                   | Все (включая анонимов) |
| `/api/user/`             | GET    | Приватный ресурс для авторизованных пользователей | Только авторизованные  |
| `/api/admin/`            | GET    | Ресурс доступен только администраторам            | Только админ           |

## Примеры Post и Put запросов:

* Регистрация - /api/register/ POST
```JSON
{
	"email": "email@gmail.com",
	"first_name": "first_name",
	"patronymic": "patronymic",
	"password": "pass",
	"password_repeat": "pass"
}
```

* Аутентификация - /api/login/ POST
```JSON
{
	"email": "email@gmail.com",
	"password": "pass"
}
```

* Обновление данных пользователя админом - /api/admin/users/<id>/ PUT
```JSON
{
    "email": "email@gmail.com",
    "first_name": "first_name",
    "patronymic": "patronymic",
    "role": "admin" or "user",
    "is_active": "True"
}
```

## Запуск проекта

```bash
git clone ...
cd project
pip install -r requirements.txt
python manage.py migrate
python manage.py runserver
```






